package org.http.proxyPQ;

import org.http.userAgent.UserAgentUtil;
import org.jsoup.Jsoup;
import org.jsoup.nodes.Document;
import org.jsoup.nodes.Element;
import org.jsoup.select.Elements;
import org.loongfei.http.HttpHandle;
import org.loongfei.http.inter.ProxyInit;
import org.loongfei.util.StringEdit;

import java.net.*;
import java.util.*;

/**
 * 获取代理并验证
 * @author haoqi
 *
 */
public class ProxyPQ implements ProxyInit {

	private static List<String> proxyList;
	static {
		/*proxyList = Arrays.asList("122.96.59.102:83", "114.32.71.5:3128",
				"110.73.52.119:8123", "110.73.29.199:8123",
				"183.61.236.54:3128", "183.61.236.53:3128",
				"123.126.32.102:8080");*/
		// 202.106.86.137
		proxyList = Arrays.asList("202.106.86.137");
	} 

	private HashSet<String> proxySet = new HashSet<String>();


	public HashSet<String> initProxySet() {
		hqProxySet2();
		hqProxySet3();
		System.out.println(proxySet);
		return proxySet;
	}

	private HashSet<String> hqProxySet2() {
		String[] urls = { "http://www.httpsdaili.com/free.asp?stype=1",
				"http://www.httpsdaili.com/free.asp?stype=2",
				"http://www.httpsdaili.com/free.asp?stype=3",
				"http://www.httpsdaili.com/free.asp?stype=4" };
		String name;
		for (String url : urls) {
			String urlnew = url;
			HashMap<String, Object> headParmasMap = new HashMap<String, Object>();
			headParmasMap.put("User-Agent", UserAgentUtil.getUserAgent());
			String htmlBody = HttpHandle.htmlBodyGet(urlnew, headParmasMap);
			if (htmlBody != null && htmlBody.length() > 5) {
				htmlBody = StringEdit.ISO8859_1ToGBK(htmlBody);
				Document doc = Jsoup.parse(htmlBody);
				Elements els = doc.select("tr.odd");
				for (Element el : els) {
					name = el.toString();
					String proxyH = StringEdit.cutString(name,
							"([0-9]+\\.){3}[0-9]+");
					String proxyP = StringEdit.cutString(name,
							"(style2\">)[0-9]+(?=</td>)").replace("style2\">",
							"");
//					System.out.println(proxyH);
					boolean c = checkProxy(proxyH, proxyP);
					if (c) {
						String proxyTemp = proxyH + ":" + proxyP;
						proxySet.add(proxyTemp);
					}
				}
			}
		}
		return proxySet;
	}

	private HashSet<String> hqProxySet3() {
		String[] urls = { "http://www.xicidaili.com/wt/",
				"http://www.xicidaili.com/wn/", 
				"http://www.xicidaili.com/nn/",
				"http://www.xicidaili.com/nt/" };
		int a = 0;
		List<String> proxyList = new ArrayList<String>(proxySet);
		String[] proxys;
		String proxyHost;
		int proxyPort;
		if(proxyList.size()!=0){
			proxys = proxyList.get(a).split(":");
			proxyHost = proxys[0];
			proxyPort = Integer.parseInt(proxys[1]);
		}
		boolean b = false;
		for (String url : urls) {
			for (int i = 1; i <= 1; i++) {
				String urlnew = url+i;
				HashMap<String, Object> headParmasMap = new HashMap<String, Object>();
				headParmasMap.put("User-Agent", UserAgentUtil.getUserAgent());
				String htmlBody = "";
				do {
					try {
//						htmlBody = HttpHandle.htmlBodyProxyGet(urlnew,
//								headParmasMap, proxyHost, proxyPort);
						htmlBody = HttpHandle.htmlBodyGet(urlnew,
								headParmasMap);
					} catch (Exception e) {
						// TODO: handle exception
					}
					if (htmlBody != null && htmlBody.length() > 2) {
						b = false;
					} else {
						a++;
						if (a > 3) {
							break;
						}
						b = true;
						if(proxyList.size()!=0){
							proxys = proxyList.get(a).split(":");
							proxyHost = proxys[0];
							proxyPort = Integer.parseInt(proxys[1]);
						}
					}
				} while (b);
				List<String> proxyList1 = new ArrayList<String>();
				proxyList1 = StringEdit
						.matcherString(
								htmlBody,
								"<td>[\\s]*([0-9]+\\.){3}[0-9]+[\\s]*</td>[\\s]*<td>[\\s]*[0-9]+[\\s]*</td>([\\s]*<td[^>]*>[\\s\\S]*?</td>[\\s]*){5}",
								proxyList1);
				for (String proxy : proxyList1) {
					if (StringEdit.searchString(proxy, "fast")) {
						proxy = StringEdit.replaceString(proxy, "", "\\s");
						String proxyH = StringEdit.cutString(proxy,
								"(?<=<td>)([0-9]+\\.){3}[0-9]+(?=</td>)");
						String proxyP = StringEdit.cutString(proxy,
								"(?<=<td>)[0-9]+(?=</td>)");
						boolean c = checkProxy(proxyH, proxyP);
						if (c) {
							String proxyTemp = proxyH + ":" + proxyP;
							proxySet.add(proxyTemp);
						}
					}
				}
			}
		}
//			String str="118.144.104.254:3128, 49.231.150.233:3128, 182.91.107.131:8118, 112.192.26.30:8118, 121.140.126.250:3128, 39.64.42.97:8118, 121.41.110.73:8080, 153.149.162.47:3128, 223.68.1.38:8000, 89.40.122.135:1907, 202.73.53.22:80, 118.161.79.199:8888, 192.169.170.237:8080, 111.199.165.215:8888, 220.248.230.217:3128, 188.166.185.212:8080, 123.153.42.52:8888, 201.55.21.183:8080, 177.67.84.221:8080, 222.32.33.21:3128, 130.237.37.106:3128, 39.79.105.28:8888, 46.101.122.118:3128, 218.103.60.205:8080, 203.195.170.25:11415, 89.40.124.139:1907, 39.183.90.244:80, 101.254.188.198:8080, 139.59.42.18:3128, 123.191.96.10:8118, 86.61.220.28:8080, 121.8.98.201:8080, 182.53.53.135:3128, 153.149.155.147:3128, 180.250.32.66:81, 116.2.28.69:8888, 185.48.189.110:8080, 123.7.115.141:9797, 153.149.158.143:3128, 153.149.161.16:3128, 123.165.33.109:8118, 113.3.74.33:8118, 153.149.158.93:3128, 138.201.130.251:3128, 123.13.117.247:8888, 94.20.21.38:8888, 116.231.195.17:9999, 94.177.164.39:1907, 153.149.162.187:3128, 128.199.254.134:80, 61.53.65.54:3128, 123.7.62.154:3128, 118.161.79.85:8888, 61.90.42.150:80, 153.149.162.16:3128, 153.149.29.4:3128, 178.159.226.170:8080, 61.132.241.103:808, 122.193.118.141:81, 123.7.82.20:3128, 111.12.82.4:80, 94.177.243.15:8888, 153.149.158.139:3128, 60.11.41.124:3128, 222.155.143.62:3128, 61.163.59.65:3128, 122.72.18.160:80, 211.95.66.1:80, 41.160.187.186:3128, 183.95.152.159:80, 211.153.17.151:80, 221.228.176.129:8118, 182.253.40.175:3128, 110.188.118.91:8118, 89.36.212.17:3128, 106.75.37.199:80, 149.56.225.174:8080, 5.189.171.14:1455, 88.198.13.237:8080, 153.149.158.189:3128, 153.149.8.176:3128, 124.166.182.24:8998, 122.226.189.14:139, 45.63.29.133:80, 46.166.162.96:3128, 1.25.191.57:8888, 116.231.195.16:9797, 52.198.84.159:8090, 89.38.148.180:3128, 153.149.29.118:3128, 119.42.123.150:80, 139.59.245.238:3128, 60.191.164.83:3128, 153.149.29.116:3128, 218.202.122.100:9999, 153.149.158.98:3128, 49.76.147.55:8118, 121.204.131.128:8088, 64.129.81.90:8080, 175.155.157.2:8118, 153.149.158.224:3128, 142.4.118.201:80, 175.19.42.214:8888, 60.21.209.114:8080, 153.149.160.217:3128, 91.185.6.20:3128, 61.136.115.147:3128, 94.177.227.168:1905, 180.140.170.55:8090, 153.149.155.223:3128, 114.224.198.174:8118, 122.117.225.161:8080, 153.149.158.173:3128, 27.151.220.199:8888, 31.14.135.32:3128, 122.224.227.202:3128, 43.245.84.53:8080, 221.217.211.141:8118, 153.149.159.68:3128, 60.11.11.163:3128, 182.88.162.130:8123, 60.207.135.221:3128, 120.25.105.45:81, 119.29.213.190:8000, 183.129.151.130:80, 210.101.131.231:8080, 153.149.158.128:3128, 39.64.42.97:8118, 121.41.110.73:8080, 202.73.53.22:80, 222.92.194.153:80, 222.33.192.238:8118, 118.180.15.151:8102, 1.163.229.133:8080, 153.149.158.122:3128, 111.177.124.140:9797, 130.237.37.106:3128, 203.91.121.74:3128, 183.185.180.180:9797, 39.79.105.28:8888, 118.160.94.212:8080, 123.57.39.224:3128, 153.149.158.191:3128, 180.161.242.142:80, 115.46.88.84:8080, 110.96.184.163:8118, 183.141.111.229:3128, 27.131.15.210:8080, 114.215.150.13:3128, 103.224.186.2:8080, 121.8.98.201:8080, 203.112.210.190:8080, 153.149.158.150:3128, 144.217.49.109:8080, 116.2.28.69:8888, 110.72.0.139:8123, 14.114.242.143:9797, 103.29.151.250:8080, 123.165.33.109:8118, 113.3.74.33:8118, 123.12.110.225:808, 113.200.159.155:9999, 36.232.113.173:3128, 92.222.70.213:3128, 204.14.188.53:7004, 123.7.62.154:3128, 117.28.255.84:80, 118.161.79.85:8888, 115.173.219.214:9797, 115.28.32.191:8081, 58.67.159.50:80, 61.132.241.103:808, 122.193.118.141:81, 123.7.82.20:3128, 212.129.18.179:80, 153.149.29.100:3128, 222.155.143.62:3128, 106.75.176.4:80, 153.149.158.192:3128, 153.149.158.163:3128, 60.191.239.236:80, 89.186.234.68:8080, 153.149.158.99:3128, 183.95.152.159:80, 204.29.115.149:8080, 211.153.17.151:80, 221.228.176.129:8118, 125.88.146.215:808, 223.67.136.218:80, 60.207.180.1:3128, 202.73.51.102:80, 78.21.187.112:80, 1.82.216.135:80, 94.177.179.139:666, 139.255.40.202:8081, 201.217.246.156:8080, 61.178.238.122:63000, 177.155.82.206:8080, 27.210.190.99:8888, 139.59.245.238:3128, 131.221.110.30:8080, 27.184.142.250:8888, 218.66.253.144:8800";
//			String[] strs = str.split(", ");
//			for(String s : strs){
//				proxySet.add(s);
//			}
//			String str1="64.129.81.90:8080, 153.149.158.224:3128, 218.25.125.146:8080, 89.38.148.215:8080, 47.89.41.164:80, 60.21.209.114:8080, 197.5.128.1:8080, 94.177.227.168:1905, 153.149.155.223:3128, 188.56.220.66:8080, 114.45.193.143:8080, 221.217.211.141:8118, 218.66.253.146:8800, 118.144.104.254:3128, 85.198.103.35:8080, 124.206.111.158:3128, 43.245.191.81:8080, 182.91.107.131:8118, 123.187.110.81:8888, 103.9.115.161:3128, 183.131.76.27:8888, 101.53.101.172:9999, 176.31.96.198:3128, 153.149.162.220:3128, 153.149.155.150:3128, 223.68.1.38:8000, 103.68.54.66:8080, 177.152.174.141:8080, 153.149.163.217:3128, 218.90.174.167:3128, 119.132.188.14:9797, 138.201.63.123:31288, 119.130.30.173:9797, 188.166.185.212:8080, 177.67.84.221:8080, 60.191.164.226:3128, 103.240.8.2:8080, 153.149.162.135:3128, 153.149.158.154:3128, 1.160.1.227:8080, 46.101.122.118:3128, 89.40.118.211:5555, 203.195.170.25:11415, 89.40.124.139:1907, 60.250.81.97:80, 39.183.90.244:80, 94.177.231.204:3128, 153.149.163.211:3128, 60.206.113.252:3128, 138.59.177.2:8080, 86.61.220.28:8080, 153.149.155.170:3128, 60.191.165.100:3128, 153.149.155.147:3128, 223.199.63.115:8888, 123.7.115.141:9797, 185.134.232.123:8080, 109.188.133.168:8081, 138.201.130.251:3128, 123.13.117.247:8888, 94.177.164.39:1907, 153.149.162.187:3128, 92.47.195.250:3128, 61.53.65.54:3128, 153.149.163.150:3128, 213.171.13.41:8080, 149.56.206.48:8080, 123.57.180.234:3128, 119.29.103.13:8888, 178.159.226.170:8080, 91.121.42.68:80, 219.150.242.54:9999, 94.177.243.15:8888, 153.149.158.139:3128, 60.11.41.124:3128, 123.115.170.112:9797, 128.199.150.50:3128, 122.72.18.160:80, 211.95.66.1:80, 41.160.187.186:3128, 185.35.67.148:3128, 218.56.132.156:8080, 123.65.217.151:9797, 119.141.101.200:9797, 202.59.173.34:8080, 165.84.178.213:3128, 110.188.118.91:8118, 202.69.71.210:808, 153.149.158.189:3128, 14.112.196.75:9999, 45.63.29.133:80, 46.166.162.96:3128, 110.240.111.91:8118, 1.25.191.57:8888, 118.168.151.233:3128, 202.107.238.51:3128, 116.231.195.16:9797, 89.38.148.180:3128, 114.215.101.42:3128, 153.149.158.157:3128, 121.122.38.181:8080, 218.56.132.154:8080, 60.194.100.51:80, 77.174.238.88:80, 109.195.51.123:8080, 218.202.122.100:9999, 60.31.185.90:8080, 121.41.30.177:9999, 122.228.179.178:80, 142.4.118.201:80, 12.33.254.195:3128, 122.72.32.73:80, 183.63.110.202:3128, 153.149.162.192:3128, 153.149.158.226:3128, 178.173.20.8:8080, 91.185.6.20:3128, 221.205.222.129:9797, 153.149.155.233:3128, 47.90.9.74:80, 119.177.127.98:8118, 153.149.158.173:3128, 139.162.60.42:1080, 185.48.115.5:3128, 1.189.10.166:8888, 94.230.243.6:8080, 220.160.22.115:80, 153.149.159.68:3128, 60.11.11.163:3128, 49.231.150.233:3128, 153.149.155.203:3128, 122.72.33.138:80, 109.104.165.213:8080, 112.192.26.30:8118, 153.149.158.94:3128, 181.143.51.106:8080, 114.242.32.217:9000, 151.202.41.233:8080, 197.97.146.62:8080, 153.149.28.213:3128, 124.88.67.54:80, 59.61.89.229:8800, 153.149.162.47:3128, 89.40.122.135:1907, 123.56.74.13:8080, 1.9.167.210:8080, 192.169.170.237:8080, 192.169.175.145:8080, 220.248.230.217:3128, 123.153.42.52:8888, 124.235.180.47:80, 222.32.33.21:3128, 220.136.22.40:8080, 123.139.59.85:9999, 218.103.60.205:8080, 103.253.145.86:8080, 112.245.42.254:8888, 58.242.248.5:80, 123.191.96.10:8118, 124.206.209.244:3128, 27.219.26.68:8888, 77.251.233.243:80, 219.157.151.126:8888, 183.185.181.12:9797, 180.250.32.66:81, 1.163.226.184:8080, 60.207.239.245:3128, 119.132.194.38:9797, 91.196.230.66:3128, 153.149.158.143:3128, 153.149.161.16:3128, 115.159.237.85:808, 153.149.155.145:3128, 61.168.162.3:80, 59.61.89.233:8800, 153.149.158.93:3128, 153.149.163.142:3128, 122.225.253.125:808, 104.236.88.115:3128, 123.170.10.93:8888, 220.166.240.132:8118, 42.5.154.175:8888, 61.90.42.150:80, 153.149.162.16:3128, 120.92.3.165:80, 182.253.6.234:8080, 60.207.14.249:3128, 61.163.59.65:3128, 153.149.158.95:3128, 208.68.36.59:8080, 91.134.16.86:8080, 123.30.238.16:3128, 2.187.186.4:8080, 23.91.96.251:80, 182.253.40.175:3128, 160.202.42.66:8080, 202.27.212.138:8080, 153.149.158.231:3128, 153.149.152.67:3128, 153.149.158.138:3128, 153.149.29.3:3128, 106.75.37.199:80";
//			String[] strs1 = str1.split(", ");
//			for(String s : strs1){
//				proxySet.add(s);
//			}
//			String str2="5.189.171.14:1455, 153.149.8.176:3128, 183.129.178.14:8080, 153.149.162.188:3128, 124.166.182.24:8998, 122.226.189.14:139, 52.198.84.159:8090, 125.31.1.25:80, 153.149.29.118:3128, 78.25.98.210:8080, 221.1.201.142:9999, 203.114.110.83:8080, 60.191.164.83:3128, 60.206.183.249:3128, 110.154.44.80:8888, 106.186.22.65:8888, 175.155.157.2:8118, 1.198.42.254:80, 180.250.41.179:8080, 177.234.12.202:3128, 175.19.42.214:8888, 171.38.141.226:8123, 199.115.117.212:80, 180.140.170.55:8090, 200.76.251.166:3128, 115.231.219.202:3128, 36.71.40.89:8080, 112.243.109.43:8888, 112.81.74.207:8888, 31.14.135.32:3128, 122.224.227.202:3128, 95.46.8.197:8080, 43.245.84.53:8080, 218.56.132.158:8080, 1.163.38.63:8080, 171.38.134.101:8123, 182.37.5.12:8888, 110.232.78.61:8080, 221.205.216.198:9797, 195.116.7.10:8080, 139.59.249.168:8080, 210.101.131.229:8080, 218.56.132.155:8080, 128.199.168.255:8888, 121.140.126.250:3128, 153.149.159.138:3128, 124.88.67.63:80, 163.47.145.30:8080, 118.161.79.199:8888, 111.199.165.215:8888, 153.149.155.140:3128, 201.55.21.183:8080, 23.91.97.54:80, 1.160.7.238:8080, 124.88.67.81:80, 154.16.127.214:8080, 113.83.237.103:9797, 112.83.240.246:8888, 27.46.32.102:9797, 101.251.199.66:3128, 176.195.18.134:8080, 185.23.142.89:80, 101.254.188.198:8080, 175.42.45.167:8888, 139.59.42.18:3128, 124.88.67.17:82, 60.17.233.55:808, 218.76.106.78:3128, 47.88.195.233:3128, 85.109.75.244:8080, 218.25.13.22:80, 111.202.154.88:8080, 104.236.0.96:8080, 182.53.53.135:3128, 60.206.60.153:3128, 122.72.32.74:80, 185.48.189.110:8080, 121.40.108.76:80, 218.106.205.145:8080, 124.234.157.80:80, 94.20.21.38:8888, 116.231.195.17:9999, 132.148.65.250:80, 60.207.239.247:3128, 128.199.254.134:80, 123.173.81.167:80, 103.50.106.42:8080, 153.149.29.4:3128, 153.149.163.166:3128, 107.170.237.191:8080, 111.12.82.4:80, 122.72.32.88:80, 153.149.158.127:3128, 213.111.162.155:8080, 202.105.179.164:3128, 94.242.58.217:3128, 114.45.193.77:8080, 89.36.212.17:3128, 31.220.55.139:3128, 112.87.108.162:81, 149.56.225.174:8080, 88.198.13.237:8080, 220.137.169.108:8998, 222.242.136.38:8888, 119.42.123.150:80, 116.231.192.168:9797, 103.55.0.197:8080, 111.118.150.4:8080, 153.149.29.116:3128, 123.59.125.68:80, 43.250.80.244:8080, 221.205.219.116:9797, 153.149.158.98:3128, 49.76.147.55:8118, 121.204.131.128:8088, 105.28.105.74:3128, 94.23.19.210:80, 120.76.243.40:80, 70.88.182.181:80, 36.80.144.144:8080, 58.217.195.141:80, 153.149.160.217:3128, 182.253.154.44:8080, 61.136.115.147:3128, 113.88.164.165:3128, 114.224.198.174:8118, 202.171.253.72:80, 123.52.130.3:9999, 122.117.225.161:8080, 27.151.220.199:8888, 1.82.216.134:80, 116.242.227.201:3128, 210.16.188.232:808";
//			String[] strs2 = str2.split(", ");
//			for(String s : strs2){
//				proxySet.add(s);
//			}
//		String str2="10.12.242.143:7718, 115.52.200.24:808, 218.241.167.190:3128, 112.91.208.78:9999, 125.118.144.147:808, 120.69.209.16:8998, 118.144.151.145:3128, 130.237.221.176:80, 183.145.168.174:8998, 58.54.77.72:808, 114.242.97.212:8080, 96.10.43.26:8080, 182.148.114.171:3128, 125.93.148.94:8118, 183.129.151.130:80, 123.138.216.94:9999, 124.88.67.54:80, 113.108.253.195:9797, 121.35.17.247:9797, 120.197.57.244:8000, 14.211.119.159:9797, 115.28.20.126:8090, 59.78.160.246:8080, 119.254.92.53:80, 118.144.48.45:3128, 27.217.25.236:8118, 202.106.16.36:3128, 114.107.162.230:8118, 120.85.132.234:80, 112.26.103.94:8118, 114.220.198.135:808, 58.59.68.91:9797, 119.131.66.214:9797, 46.62.159.129:8080, 183.62.9.84:8080, 61.145.217.106:8001, 182.84.81.160:8998, 114.107.152.111:8118, 120.32.214.42:8998, 125.118.75.156:808, 49.205.247.242:8080, 125.118.148.3:808, 14.154.173.120:9797, 61.153.145.202:25, 124.88.67.10:80, 61.184.185.68:3128, 203.91.121.74:3128, 110.125.53.95:8118, 120.86.121.134:8080, 121.14.9.76:110, 182.90.105.145:8123, 220.166.241.13:8118, 195.135.238.24:88, 118.144.154.253:3128, 183.19.44.169:3128, 128.199.169.17:80, 101.231.46.34:8000, 220.161.218.94:3128, 42.51.4.25:80, 202.97.140.147:81, 182.88.253.151:8123, 14.211.72.25:9797, 60.186.20.74:8118, 59.46.220.214:9000, 59.78.160.244:8080, 123.165.125.69:8118, 218.56.132.157:8080, 123.13.205.185:8080, 125.46.19.92:808, 124.131.221.142:9999, 182.88.30.8:8123, 117.79.93.39:8808, 59.40.195.59:9797, 219.133.31.120:8888, 116.7.248.45:808, 119.188.94.145:80, 121.49.107.11:3128, 49.68.6.166:8118, 124.239.177.85:8080, 121.201.18.74:3128, 171.38.142.102:8123, 122.72.33.139:80, 122.72.32.72:80, 125.118.146.182:808, 60.218.117.80:8118, 171.38.177.156:8123, 125.121.117.52:808, 110.208.27.75:9000, 14.20.110.246:9797, 58.251.132.181:8888, 218.201.183.18:8080, 121.61.101.28:8118, 113.109.237.174:9797, 113.200.159.155:9999, 125.118.78.189:808, 183.167.22.208:8998, 171.36.254.245:8123, 176.53.86.136:80, 61.145.162.21:9999, 124.91.147.186:8118, 221.237.154.57:9797, 222.223.62.172:8998, 202.118.8.13:3128, 121.31.159.88:8123, 121.17.126.68:8081, 58.67.159.50:80, 121.34.13.92:9797, 182.88.31.6:8123, 101.66.251.216:21190, 192.99.120.40:80, 58.214.5.229:80, 183.54.205.112:9797, 182.88.228.73:8123, 121.31.150.221:8123, 119.52.79.132:8080, 222.186.45.123:62222, 124.244.33.148:8088, 115.28.226.68:8118, 116.247.110.115:8080, 119.254.88.53:8080, 179.164.220.205:8080, 211.103.250.145:80, 139.196.140.9:80, 211.75.115.20:80, 58.221.190.50:80, 101.226.249.237:80, 119.48.191.33:8118, 106.118.120.159:8118, 58.208.6.128:8998, 218.6.145.11:9797, 122.72.111.98:80, 36.37.81.130:8080, 202.99.172.145:8081, 120.86.208.82:8888, 182.118.168.237:8888, 59.44.152.110:9999, 61.157.198.67:8080, 110.73.4.169:8123, 162.243.202.25:80, 125.120.200.213:808, 183.19.47.142:3128, 222.181.11.52:8118, 218.29.111.106:9999, 119.28.14.80:81, 58.52.201.116:8080, 27.191.234.69:9999, 218.63.208.223:3128, 120.84.240.106:8080, 59.78.47.47:8123, 106.57.22.25:8118, 125.118.76.241:808, 177.234.12.202:3128, 183.19.45.183:3128, 123.124.168.149:80, 60.21.209.114:8080, 121.204.165.178:8118, 60.176.164.2:8118, 61.129.129.72:8080, 60.184.150.148:8998, 153.35.4.130:8118, 180.104.106.130:8998, 123.13.204.139:8080, 218.56.132.158:8080, 52.220.58.110:80, 221.204.117.116:9797, 116.17.139.94:9797, 14.114.240.52:9797, 124.115.211.30:9999, 113.143.43.92:8998, 181.197.188.33:3128, 58.134.102.3:16303, 58.246.194.70:8080, 113.109.27.103:808, 60.186.200.205:8118, 113.253.113.100:8380, 219.146.2.105:23, 58.52.201.118:8080, 106.0.5.95:8080, 110.73.30.101:8123, 171.38.199.252:8123, 110.179.53.134:8888, 125.209.67.74:80, 124.126.126.105:80, 39.67.92.185:8118, 110.72.25.85:8123, 61.163.39.70:9999, 61.141.85.102:9797, 14.120.75.46:9797, 139.201.30.169:8998, 59.78.160.247:8080, 116.16.105.21:9000, 39.75.205.218:8080, 158.69.209.181:8888, 124.88.67.63:80, 123.125.8.253:1209, 101.29.213.119:8118, 1.194.37.204:8118, 58.60.85.32:9797, 221.214.221.148:3128, 218.241.234.48:8080, 218.90.174.167:3128, 14.211.145.230:9797, 156.210.99.61:8080, 121.31.101.177:8123, 139.162.20.41:80, 203.130.228.60:8080, 223.202.20.221:443, 171.38.154.86:8123, 183.14.42.32:9797, 123.206.20.26:8080, 121.31.100.158:8123, 116.255.192.209:808, 182.88.229.42:8123, 106.37.177.251:3128, 183.39.157.229:9797, 59.78.160.245:8080, 59.44.244.14:9797, 61.144.68.100:9999, 36.249.195.226:8118, 101.251.199.66:3128, 218.78.210.190:8080, 59.78.160.248:8080, 123.207.25.155:8080, 222.169.193.162:8099, 115.200.87.238:8998, 125.121.118.234:808, 171.38.184.178:8123, 115.238.228.9:8080, 221.204.11.8:8080, 125.67.147.140:8118, 103.21.116.85:3128, 210.68.95.62:3128, 211.167.84.53:443, 218.76.106.78:3128, 80.254.104.117:8081, 120.86.135.40:8888, 221.237.155.64:9797, 61.158.173.14:8080, 182.90.0.142:80, 211.144.76.58:9000, 61.155.91.3:8080, 122.224.209.98:3128, 60.191.163.147:3128, 211.147.240.86:808, 121.32.118.121:9797, 110.72.44.50:8123, 60.169.114.15:808, 114.231.159.144:8088, 110.155.138.247:8998, 125.111.168.180:8118, 121.43.196.126:8118, 116.247.110.114:8080, 202.117.120.24:808, 60.173.30.124:8888, 124.88.67.24:80, 173.208.184.156:5555, 52.77.226.86:3128, 125.120.200.42:808, 221.175.232.183:8118, 121.204.165.56:8118, 121.31.49.19:8123, 123.57.180.234:3128, 182.91.28.207:9999, 116.25.103.151:9797, 121.31.87.168:8123, 221.7.206.140:8080, 124.244.39.44:3128, 60.185.237.81:808, 219.150.242.54:9999, 1.186.133.105:8080, 91.205.122.75:8081, 119.141.14.184:9797, 182.90.77.44:8123, 222.83.14.145:3128, 110.73.3.25:80, 104.224.37.83:3128, 61.138.167.110:9999, 121.13.55.89:9797, 112.101.80.171:9797, 218.56.132.156:8080, 221.7.238.116:8123, 221.192.134.91:8081, 114.229.235.113:8118, 61.163.55.3:9000, 220.162.205.196:8998, 58.251.233.188:9999, 177.56.229.116:8080, 221.204.99.245:9797, 125.118.79.174:808, 115.46.80.203:8123, 171.38.213.152:8123, 119.147.161.55:3128, 61.152.81.193:9100, 124.88.67.52:843, 61.163.236.177:9999, 118.178.180.213:8118, 116.19.176.156:8118, 210.82.92.77:3128, 119.147.115.30:8088, 200.108.35.60:8088, 171.37.11.67:9797, 211.162.79.68:80, 123.172.112.183:8998, 218.23.121.74:8118, 123.131.15.44:8118, 118.254.179.156:8118, 24.249.80.22:3128, 171.38.185.124:8123, 94.141.168.215:8080, 125.121.119.79:808, 117.65.113.12:8998, 222.186.45.115:62222, 110.72.28.72:8123, 42.96.131.88:3128, 202.104.188.53:80, 45.76.105.243:8080, 110.208.26.36:9000, 121.31.157.172:8123, 119.29.120.71:3128, 173.208.165.204:5555, 1.196.160.214:9999, 14.211.58.240:9797, 182.37.79.242:8118, 116.242.227.201:3128, 121.13.165.26:808, 124.127.105.236:808, 223.15.33.113:9797, 222.222.251.185:9999, 124.226.146.221:8118, 223.240.166.94:8118, 42.121.28.111:3128, 124.67.210.252:80";
//		String[] strs2 = str2.split(", ");
//		for(String s : strs2){
//			proxySet.add(s);
//		}
		return proxySet;
	}

	private void setProxy(String proxyAddr, int proxyPort) {
		System.setProperty("java.net.useSystemProxies", "true");
		// HTTP代理
		System.setProperty("http.proxyHost", proxyAddr);
		System.setProperty("http.proxyPort", proxyPort + "");
		// HTTPS代理
		System.setProperty("https.proxyHost", proxyAddr);
		System.setProperty("https.proxyPort", proxyPort + "");
	}

	private Proxy getSystemProxy(String uri) {
		Proxy proxy = null;
		try {
			ProxySelector ps = ProxySelector.getDefault();
			List<Proxy> proxyList = ps.select(new URI(uri));
			for (Proxy p : proxyList) {
				// System.out.println("代理类型 : " + p.type());
				InetSocketAddress addr = (InetSocketAddress) p.address();
				if (addr == null) {
					// System.out.println("没有代理");
				} else {
					proxy = p;
					// System.out.println("代理主机 : " + addr.getHostName());
					// System.out.println("代理端口 : " + addr.getPort());
				}
			}
		} catch (Exception e) {
			e.printStackTrace();
		}
		return proxy;
	}

	public boolean checkProxy(String proxyHost, String proxyPort) {
		// Proxy类代理方法
		boolean b = false;
		int port = Integer.parseInt(proxyPort);
		// 通过系统属性设置代理
		setProxy(proxyHost, port);
		String urlStr = "http://www.baidu.com/";
		// 获取代理
		Proxy proxy = getSystemProxy(urlStr);
		URLConnection conn = null;
		URL url = null;
		try {
			url = new URL(urlStr);
			conn = url.openConnection(proxy);
		} catch (Exception e) {
			e.printStackTrace();
			conn = null;
		}
		if (conn == null) {
			b = false;
		} else {
			b = true;
//			System.out.println("ok");
		}
		return b;
	}

	public HashSet<String> getProxySet() {
		return proxySet;
	}

	public void setProxySet(HashSet<String> proxySet) {
		this.proxySet = proxySet;
	}

}
